<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trial Recruitment and Onboarding Timeline</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <h1>Trial Recruitment and Onboarding Timeline</h1>
    <div id="timeline"></div>

    <script>
        // Updated timeline with specified sequence
        const centresData = [
            { Centre: "Centre 1", EthicsApprovalDate: "2025-05-01" },
            { Centre: "Centre 2", EthicsApprovalDate: "2025-06-01" },
            { Centre: "Centre 3", EthicsApprovalDate: "2025-07-01" },
            { Centre: "Centre 4", EthicsApprovalDate: "2025-08-01" },
            { Centre: "Centre 5", EthicsApprovalDate: "2025-09-01" },
            { Centre: "Centre 6", EthicsApprovalDate: "2025-10-01" },
            { Centre: "Centre 7", EthicsApprovalDate: "2025-11-01" },
            { Centre: "Centre 8", EthicsApprovalDate: "2025-12-01" },
            { Centre: "Centre 9", EthicsApprovalDate: "2026-01-01" },
            { Centre: "Centre 10", EthicsApprovalDate: "2026-03-01" },
            { Centre: "Centre 11", EthicsApprovalDate: "2026-05-01" },
            { Centre: "Centre 12", EthicsApprovalDate: "2026-07-01" },
        ];

        const tasks = [];
        const taskColours = {
            "Ethics Approval": "#1f77b4",
            "Onboarding": "#ff7f0e",
            "Participant Screening": "#2ca02c",
            "Legal Approval": "#d62728",
            "Recruitment": "#9467bd",
            "Baseline Data Collection": "#8c564b",
            "Randomisation": "#e377c2",
            "Clinic Appointment 1": "#7f7f7f",
            "Clinic Appointment 2": "#bcbd22",
            "Clinic Appointment 3": "#17becf",
        };

        // Generate timeline tasks based on the new sequence
        centresData.forEach(({ Centre, EthicsApprovalDate }) => {
            const ethicsApproval = new Date(EthicsApprovalDate);
            const onboardingEnd = new Date(ethicsApproval);
            onboardingEnd.setDate(onboardingEnd.getDate() + 14); // 2 weeks onboarding

            const screeningEnd = new Date(onboardingEnd);
            screeningEnd.setDate(screeningEnd.getDate() + 14); // 2 weeks participant screening

            const legalApprovalEnd = new Date(screeningEnd);
            legalApprovalEnd.setDate(legalApprovalEnd.getDate() + 7); // 1 week legal approval

            const recruitmentEnd = new Date(legalApprovalEnd);
            recruitmentEnd.setDate(recruitmentEnd.getDate() + 7); // 1 week recruitment

            const baselineStart = new Date(recruitmentEnd);

            const randomisationEnd = new Date(baselineStart);
            randomisationEnd.setDate(randomisationEnd.getDate() + 7); // 1 week randomisation

            const clinic1Start = new Date(randomisationEnd);
            clinic1Start.setMonth(clinic1Start.getMonth() + 3); // 3 months gap for Clinic 1

            const clinic2Start = new Date(clinic1Start);
            clinic2Start.setMonth(clinic2Start.getMonth() + 3); // 3 months gap for Clinic 2

            const clinic3Start = new Date(clinic2Start);
            clinic3Start.setMonth(clinic3Start.getMonth() + 3); // 3 months gap for Clinic 3

            tasks.push(
                { Task: "Ethics Approval", Centre, Start: ethicsApproval, End: onboardingEnd },
                { Task: "Onboarding", Centre, Start: onboardingEnd, End: screeningEnd },
                { Task: "Participant Screening", Centre, Start: screeningEnd, End: legalApprovalEnd },
                { Task: "Legal Approval", Centre, Start: legalApprovalEnd, End: recruitmentEnd },
                { Task: "Recruitment", Centre, Start: recruitmentEnd, End: baselineStart },
                { Task: "Baseline Data Collection", Centre, Start: baselineStart, End: randomisationEnd },
                { Task: "Randomisation", Centre, Start: randomisationEnd, End: clinic1Start },
                { Task: "Clinic Appointment 1", Centre, Start: clinic1Start, End: clinic2Start },
                { Task: "Clinic Appointment 2", Centre, Start: clinic2Start, End: clinic3Start },
                { Task: "Clinic Appointment 3", Centre, Start: clinic3Start, End: new Date(clinic3Start) }
            );
        });

        // Prepare data for Plotly
        const plotData = tasks.map(task => ({
            x: [task.Start.toISOString().split("T")[0], task.End.toISOString().split("T")[0]],
            y: [task.Centre, task.Centre],
            type: "scatter",
            mode: "lines+markers",
            line: { width: 10, color: taskColours[task.Task] },
            name: task.Task,
            hoverinfo: "name+x",
        }));

        // Define layout
        const layout = {
            title: "Trial Recruitment and Onboarding Timeline",
            xaxis: {
                title: "Date",
                type: "date",
                tickformat: "%b-%Y",
            },
            yaxis: {
                title: "Centres",
                automargin: true,
            },
            margin: {
                l: 150, // Space for long centre/task names
            },
        };

        // Render the Plotly chart
        Plotly.newPlot("timeline", plotData, layout);
    </script>
</body>
</html>
