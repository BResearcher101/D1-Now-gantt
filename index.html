<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trial Activity Heatmap</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <h1>Trial Activity Heatmap</h1>
    <div>
        <h3>Enter Onboarding Dates for Centres</h3>
        <form id="onboarding-form">
            <!-- Form for user inputs -->
            <div>
                <label for="centre1">Centre 1:</label>
                <input type="date" id="centre1" name="centre1" value="2025-05-01">
            </div>
            <div>
                <label for="centre2">Centre 2:</label>
                <input type="date" id="centre2" name="centre2" value="2025-06-01">
            </div>
            <div>
                <label for="centre3">Centre 3:</label>
                <input type="date" id="centre3" name="centre3" value="2025-07-01">
            </div>
            <div>
                <label for="centre4">Centre 4:</label>
                <input type="date" id="centre4" name="centre4" value="2025-08-01">
            </div>
            <div>
                <label for="centre5">Centre 5:</label>
                <input type="date" id="centre5" name="centre5" value="2025-09-01">
            </div>
            <div>
                <label for="centre6">Centre 6:</label>
                <input type="date" id="centre6" name="centre6" value="2025-10-01">
            </div>
            <div>
                <label for="centre7">Centre 7:</label>
                <input type="date" id="centre7" name="centre7" value="2025-11-01">
            </div>
            <div>
                <label for="centre8">Centre 8:</label>
                <input type="date" id="centre8" name="centre8" value="2025-12-01">
            </div>
            <div>
                <label for="centre9">Centre 9:</label>
                <input type="date" id="centre9" name="centre9" value="2026-01-01">
            </div>
            <div>
                <label for="centre10">Centre 10:</label>
                <input type="date" id="centre10" name="centre10" value="2026-03-01">
            </div>
            <div>
                <label for="centre11">Centre 11:</label>
                <input type="date" id="centre11" name="centre11" value="2026-05-01">
            </div>
            <div>
                <label for="centre12">Centre 12:</label>
                <input type="date" id="centre12" name="centre12" value="2026-07-01">
            </div>
            <button type="button" id="generate-heatmap">Generate Heatmap</button>
        </form>
    </div>
    <div id="heatmap"></div>

    <script>
        // Generate trial activity data and heatmap dynamically
        document.getElementById("generate-heatmap").addEventListener("click", () => {
            const formData = new FormData(document.getElementById("onboarding-form"));
            const centres = [];
            const activityLabels = ["Onboarding", "Baseline Data Collection", "Clinic Appointment 1", "Clinic Appointment 2"];
            const activityColours = {
                "Onboarding": 1,
                "Baseline Data Collection": 2,
                "Clinic Appointment 1": 3,
                "Clinic Appointment 2": 4
            };

            // Initialize heatmap data
            const heatmapData = Array(12).fill(null).map(() => Array(48).fill(0)); // 12 centres x 48 months (4 years)

            for (let i = 0; i < 12; i++) {
                const onboardingDate = new Date(formData.get(`centre${i + 1}`));
                const startMonth = onboardingDate.getFullYear() * 12 + onboardingDate.getMonth();

                // Assign activities to heatmap
                heatmapData[i][startMonth] = activityColours["Onboarding"];
                heatmapData[i][startMonth + 4] = activityColours["Baseline Data Collection"]; // 4 months after onboarding
                heatmapData[i][startMonth + 8] = activityColours["Clinic Appointment 1"]; // 8 months after onboarding
                heatmapData[i][startMonth + 12] = activityColours["Clinic Appointment 2"]; // 12 months after onboarding
            }

            // Prepare data for Plotly heatmap
            const plotData = [{
                z: heatmapData,
                x: Array.from({ length: 48 }, (_, i) => `Month ${i + 1}`), // Months
                y: Array.from({ length: 12 }, (_, i) => `Centre ${i + 1}`), // Centres
                type: "heatmap",
                colorscale: [
                    [0, "white"],
                    [0.25, "#1f77b4"], // Onboarding
                    [0.5, "#ff7f0e"], // Baseline Data Collection
                    [0.75, "#2ca02c"], // Clinic Appointment 1
                    [1, "#d62728"], // Clinic Appointment 2
                ],
                showscale: true,
                colorbar: {
                    title: "Activities",
                    tickvals: [1, 2, 3, 4],
                    ticktext: activityLabels
                }
            }];

            // Define layout
            const layout = {
                title: "Trial Activity Heatmap",
                xaxis: {
                    title: "Time (Months)",
                    automargin: true,
                },
                yaxis: {
                    title: "Centres",
                    automargin: true,
                },
                margin: {
                    l: 150, // Space for long Centre names
                },
            };

            // Render the Plotly heatmap
            Plotly.newPlot("heatmap", plotData, layout);
        });
    </script>
</body>
</html>
